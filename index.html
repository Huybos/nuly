<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NULY ‚Äì ·∫¢ R·∫¨P BU√îN V√ÄNG ‚Ä¢ Trading Calculator PRO (OFFLINE)</title>
<style>
:root{--bg:#0b1220;--card:#121a2a;--text:#e8f0ff;--muted:#9fb0d1;--accent:#29d391;--danger:#ff6b6b;--warn:#ffd166;--accentBorder:#33e3a0}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#09111f,#0b1424 40%,#0a0f1a);color:var(--text)}
header{padding:14px 12px;background:rgba(11,20,36,.55);backdrop-filter:blur(6px);position:sticky;top:0;border-bottom:1px solid rgba(255,255,255,.06);z-index:5}
h1{margin:0;font-size:18px} .sub{color:var(--muted);font-size:12px;margin-top:4px}
.container{max-width:1100px;margin:10px auto;padding:0 12px 70px}
.tabs{display:flex;gap:8px;flex-wrap:wrap}
.tab-btn{padding:8px 10px;border-radius:10px;background:#14213a;border:1px solid #243252;color:#d7e6ff;cursor:pointer}
.tab-btn.active{background:#0ea371;border-color:#0ea371}
.card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:12px;margin-top:10px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.grid{display:grid;gap:12px}.g2{grid-template-columns:1fr 1fr}.g3{grid-template-columns:repeat(3,1fr)}@media(max-width:900px){.g2,.g3{grid-template-columns:1fr}}
label{font-size:12px;color:var(--muted)}
input,select{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:#0e1626;color:#e8f0ff}
/* radio */
input[type="radio"]{transform:scale(1.35);margin-right:8px;accent-color:#0ea371;vertical-align:middle}
.hint{font-size:11px;color:#9fb0d1;margin-top:4px;opacity:.9}
.kpi{display:grid;gap:8px;grid-template-columns:repeat(3,1fr)}@media(max-width:900px){.kpi{grid-template-columns:repeat(2,1fr)}}
.metric{background:#0e1728;border:1px solid rgba(255,255,255,.09);border-radius:12px;padding:10px}
.metric .label{color:#9fb0d1;font-size:12px}
.metric .val{font-size:20px;margin-top:4px}
.good .val{color:var(--accent)} .bad .val{color:var(--danger)} .warn .val{color:var(--warn)}
.row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
button{background:#14213a;border:1px solid rgba(255,255,255,.08);color:#d7e6ff;border-radius:10px;padding:8px 12px;cursor:pointer}
.primary{background:#0ea371;border-color:#0ea371}
table{width:100%;border-collapse:collapse;margin-top:8px;font-size:14px}th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,.06);text-align:right}th:first-child,td:first-child{text-align:left}
.hidden{display:none}
.note{color:#ffd166;font-size:12px;margin:-2px 0 6px}
footer{position:fixed;right:10px;bottom:8px;color:#9fb0d1;font-size:12px}
.help{font-size:11px;color:#ffd166}
.focus-wrap{margin-top:12px;padding:14px;border-radius:18px;background:linear-gradient(180deg,#0e1524,#0e172a);
  border:2.5px solid var(--accentBorder);box-shadow:0 0 0 4px rgba(51,227,160,.10), 0 14px 34px rgba(0,0,0,.40)}
.focus-title{font-size:13px;color:#a7ffda;margin-bottom:8px;letter-spacing:.2px}
.badge-warn{display:inline-block;padding:4px 8px;border-radius:999px;background:#2c1f07;border:1px solid #f4a261;color:#ffd166;font-size:11px;margin-left:6px}
.small{font-size:12px;color:#9fb0d1}
/* Collapsible notes */
details.expl{margin-top:6px;background:#0e1524;border:1px dashed rgba(255,255,255,.12);border-radius:10px;padding:6px}
details.expl>summary{cursor:pointer;color:#a7ffda;font-size:12px;outline:none}
details.expl[open]{box-shadow:inset 0 0 0 1px rgba(41,211,145,.25)}
.toggle-notes{font-size:12px;margin-left:auto}
</style>

<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0ea371">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="icons/icon-192.png">

</head>
<body>
<header>
  <h1>‚öúÔ∏è NULY ‚Äì ·∫¢ R·∫¨P BU√îN V√ÄNG ‚Ä¢ Trading Calculator PRO</h1>
  <div class="sub">R:R ‚Ä¢ Qu·∫£n tr·ªã v·ªën & r·ªßi ro ‚Ä¢ (B·∫£n OFFLINE)</div>
</header>
<div class="container">
  <div class="tabs">
    <button class="tab-btn active" data-tab="sizing">Qu·∫£n l√Ω kh·ªëi l∆∞·ª£ng l·ªánh</button>
    <button class="tab-btn" data-tab="daily">Qu·∫£n l√Ω r·ªßi ro/ng√†y (Prop Rules)</button>
    <button class="tab-btn" data-tab="help">üìñ H∆∞·ªõng d·∫´n</button>
  </div>

  <!-- 1) POSITION SIZING -->
  <section id="sizing" class="card">
    <h2>Qu·∫£n l√Ω kh·ªëi l∆∞·ª£ng l·ªánh</h2>
    <div class="row">
      <label><input type="radio" name="mode" value="risk" checked> Nh·∫≠p <b>R·ªßi ro %/l·ªánh</b> ‚Üí t√≠nh Lot</label>
      <label><input type="radio" name="mode" value="lot"> Nh·∫≠p <b>Kh·ªëi l∆∞·ª£ng Lot</b> ‚Üí t√≠nh R·ªßi ro %</label>
      <span class="badge-warn" id="lot-note" style="display:none">ƒê√£ √°p min lot 0.01 ‚Üí r·ªßi ro th·ª±c t·∫ø tƒÉng</span>
    </div>
    <div class="grid g3">
      <div><label>V·ªën t√†i kho·∫£n ($)</label><input id="equity" type="number" value="5000"></div>
      <div><label>T·ªâ l·ªá th·∫Øng (p)</label><input id="p" type="number" step="0.01" value="0.55"></div>
      <div><label>T·ª∑ l·ªá R:R</label><input id="rr" type="number" step="0.1" value="3"></div>
    </div>
    <div class="grid g3">
      <div id="riskRow">
        <label>R·ªßi ro %/l·ªánh</label>
        <input id="riskPct" type="range" min="0.1" max="2" step="0.05" value="0.5">
        <div class="hint">ƒêang ch·ªçn: <b id="riskVal">0.50%</b>.</div>
      </div>
      <div id="lotRow" class="hidden">
        <label>Kh·ªëi l∆∞·ª£ng Lot</label>
        <input id="lotIn" type="number" step="0.01" value="0.10">
        <div class="hint">C√¥ng th·ª©c: <code>R = Lot √ó SL √ó pipValuePerLot</code>. T·ªëi thi·ªÉu 0.01 lot.</div>
      </div>
      <div><label>Kho·∫£ng c√°ch d·ª´ng l·ªó (SL)</label><input id="sl" type="number" value="30"></div>
      <div><label>Gi√° tr·ªã m·ªói pip/lot ($)</label><input id="per" type="number" value="100"></div>
    </div>
    <div class="grid g3">
      <div><label>Ph√≠/hoa h·ªìng m·ªói l·ªánh ($)</label><input id="fee" type="number" value="0"></div>
      <div><label>S·ªë l·ªánh/ng√†y</label><input id="tpd" type="number" value="3"></div>
      <div><label>S·ªë ng√†y/nƒÉm</label><input id="days" type="number" value="240"></div>
    </div>
    <div class="row">
      <button class="primary" onclick="calc()">T√≠nh</button>
      <button onclick="saveCfg()">L∆∞u</button>
      <button onclick="loadCfg()">T·∫£i</button>
    </div>

    <div class="focus-wrap">
      <div class="focus-title">üìä K·∫øt qu·∫£ ch√≠nh</div>
      <div class="kpi">
        <div class="metric"><div class="label">Ti·ªÅn r·ªßi ro ƒë·∫∑t (theo %)</div><div class="val" id="riskUsdTarget">‚Äî</div></div>
        <div class="metric"><div class="label">Kh·ªëi l∆∞·ª£ng Lot (‚â•0.01)</div><div class="val" id="lotOut">‚Äî</div></div>
        <div class="metric"><div class="label">Ti·ªÅn r·ªßi ro <u>th·ª±c t·∫ø</u> ($)</div><div class="val" id="riskUsd">‚Äî</div></div>
        <div class="metric good"><div class="label">Ti·ªÅn th·∫Øng/l·ªánh ($)</div><div class="val" id="win">‚Äî</div></div>
        <div class="metric bad"><div class="label">Ti·ªÅn thua/l·ªánh ($)</div><div class="val" id="loss">‚Äî</div></div>
        <div class="metric"><div class="label">K·ª≥ v·ªçng/l·ªánh ($)</div><div class="val" id="ev">‚Äî</div></div>
        <div class="metric warn"><div class="label">K·ª≥ v·ªçng/ng√†y ($)</div><div class="val" id="evDay">‚Äî</div></div>
        <div class="metric"><div class="label">K·ª≥ v·ªçng/th√°ng ($)</div><div class="val" id="evMonth">‚Äî</div></div>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h3>M√¥ ph·ªèng theo nhi·ªÅu m·ª©c r·ªßi ro</h3>
      <div class="hint">B·∫£ng d∆∞·ªõi t√≠nh theo c√°c m·ª©c Risk% ph·ªï bi·∫øn (0.25‚Äì2.0%). √Åp min lot 0.01.</div>
      <table id="sim"><thead><tr><th>R·ªßi ro %</th><th>R ƒë·∫∑t ($)</th><th>Lot</th><th>R th·ª±c t·∫ø ($)</th><th>EV/l·ªánh</th><th>Th·∫Øng</th><th>Thua</th></tr></thead><tbody></tbody></table>
    </div>
  </section>

  <!-- 2) DAILY RISK with hidden notes -->
  <section id="daily" class="card hidden">
    <div class="row" style="align-items:center">
      <h2 style="margin:0">Qu·∫£n l√Ω r·ªßi ro/ng√†y (Chu·∫©n FTMO/Prop)</h2>
      <button class="toggle-notes" onclick="toggleAllNotes()">B·∫≠t/T·∫Øt t·∫•t c·∫£ ghi ch√∫</button>
    </div>
    <div class="small">Ki·ªÉm tra vi ph·∫°m theo <b>Start-of-Day</b> & <b>Overall</b>. R/l·ªánh c√≥ th·ªÉ <i>‚ÄúL·∫•y t·ª´ tab Kh·ªëi l∆∞·ª£ng‚Äù</i>.</div>

    <div class="grid g3">
      <div>
        <label>Start-of-day equity E‚ÇÄ ($)</label>
        <input id="qE0" type="number" value="100000">
        <details class="expl"><summary>Ghi ch√∫</summary>
          <div>E‚ÇÄ l√† <b>s·ªë d∆∞/Equity t·∫°i 00:00</b> (theo gi·ªù server m√† qu·ªπ quy ƒë·ªãnh). <br>
          Quy t·∫Øc daily th∆∞·ªùng: <i>b·∫•t k·ª≥ l√∫c n√†o trong ng√†y</i>, n·∫øu Equity gi·∫£m v∆∞·ª£t <code>E‚ÇÄ √ó Daily%</code> ‚Üí <b>vi ph·∫°m</b>.
          </div>
        </details>
      </div>
      <div>
        <label>Daily loss limit (%)</label>
        <input id="qDayPct" type="number" step="0.1" value="5">
        <details class="expl"><summary>Ghi ch√∫</summary>
          <div>V√≠ d·ª• FTMO: <b>5%/ng√†y</b>. Daily cap = <code>E‚ÇÄ √ó 5%</code>. <br>
          ·ªû ƒë√¢y app t√≠nh <b>Daily used = max(0, ‚àíP/L h√¥m nay)</b> (ƒë√£ g·ªìm floating).</div>
        </details>
      </div>
      <div>
        <label>R·ªßi ro m·ªói l·ªánh R ($)</label>
        <input id="qR" type="number" value="300">
        <details class="expl"><summary>Ghi ch√∫</summary>
          <div><b>R/l·ªánh</b> l√† m·ª©c l·ªó ti·ªÅn n·∫øu SL hit cho 1 l·ªánh. <br>
          N√™n d√πng n√∫t <i>L·∫•y t·ª´ tab Kh·ªëi l∆∞·ª£ng</i> ƒë·ªÉ l·∫•y <b>R th·ª±c t·∫ø</b> sau l√†m tr√≤n lot (‚â•0.01).</div>
        </details>
      </div>
    </div>

    <div class="grid g3">
      <div>
        <label>P/L h√¥m nay (realized + floating) ($)</label>
        <input id="qPLToday" type="number" value="0">
        <details class="expl"><summary>Ghi ch√∫</summary>
          <div>Nh·∫≠p <b>l√£i/l·ªó hi·ªán t·∫°i</b> c·ªßa ri√™ng ng√†y h√¥m nay, g·ªìm c·∫£ l·ªánh ƒëang ch·∫°y (floating). <br>
          S·ªë √¢m = ƒëang l·ªó ‚Üí t√≠nh v√†o <b>Daily used</b>.</div>
        </details>
      </div>
      <div>
        <label>Equity tham chi·∫øu (overall) ($)</label>
        <input id="qEq" type="number" value="100000">
        <details class="expl"><summary>Ghi ch√∫</summary>
          <div>ƒêa s·ªë qu·ªπ d√πng <b>v·ªën ban ƒë·∫ßu</b> l√†m m·ªëc overall (VD 100k). <br>
          M·ªôt s·ªë n∆°i c√≥ bi·∫øn th·ªÉ theo <i>max equity ƒë·∫°t ƒë∆∞·ª£c</i> ‚Äî tu·ª≥ qu·ªπ, anh ch·ªânh t·∫°i ƒë√¢y.</div>
        </details>
      </div>
      <div>
        <label>Overall loss limit (%)</label>
        <input id="qAllPct" type="number" step="0.1" value="10">
        <details class="expl"><summary>Ghi ch√∫</summary>
          <div>V√≠ d·ª• FTMO: <b>10% t·ªïng</b>. Overall cap = <code>Equity tham chi·∫øu √ó 10%</code>.</div>
        </details>
      </div>
    </div>

    <div class="grid g3">
      <div>
        <label>L·ªó l≈©y k·∫ø tr∆∞·ªõc h√¥m nay ($)</label>
        <input id="qCumLoss" type="number" value="0">
        <details class="expl"><summary>Ghi ch√∫</summary>
          <div>T·ªïng l·ªó ƒë√£ ph√°t sinh <b>tr∆∞·ªõc 00:00 h√¥m nay</b> (kh√¥ng bao g·ªìm P/L c·ªßa h√¥m nay).</div>
        </details>
      </div>
      <div>
        <label class="small">&nbsp;</label>
        <button onclick="pullRFromSizing()">L·∫•y R t·ª´ tab Kh·ªëi l∆∞·ª£ng</button>
      </div>
      <div>
        <label class="small">&nbsp;</label>
        <button class="primary" onclick="calcProp()">T√≠nh</button>
      </div>
    </div>

    <div class="focus-wrap">
      <div class="focus-title">üìè K·∫øt qu·∫£ ki·ªÉm so√°t vi ph·∫°m</div>
      <div class="kpi">
        <div class="metric"><div class="label">Daily cap ($) = E‚ÇÄ √ó %</div><div class="val" id="qDayCap">‚Äî</div></div>
        <div class="metric"><div class="label">Daily loss ƒë√£ d√πng ($)</div><div class="val" id="qDayUsed">‚Äî</div></div>
        <div class="metric"><div class="label">Daily loss c√≤n l·∫°i ($)</div><div class="val" id="qDayRemain">‚Äî</div></div>

        <div class="metric"><div class="label">Overall cap ($) = Ref √ó %</div><div class="val" id="qAllCap">‚Äî</div></div>
        <div class="metric"><div class="label">Overall loss ƒë√£ d√πng ($)</div><div class="val" id="qAllUsed">‚Äî</div></div>
        <div class="metric"><div class="label">Overall c√≤n l·∫°i ($)</div><div class="val" id="qAllRemain">‚Äî</div></div>

        <div class="metric warn"><div class="label">C√≤n ch·ªãu ƒë∆∞·ª£c m·∫•y l·ªánh thua (Daily)</div><div class="val" id="qMaxLoseDay">‚Äî</div></div>
        <div class="metric warn"><div class="label">C√≤n ch·ªãu ƒë∆∞·ª£c m·∫•y l·ªánh thua (Overall)</div><div class="val" id="qMaxLoseAll">‚Äî</div></div>
        <div class="metric"><div class="label">Khuy·∫øn ngh·ªã</div><div class="val" id="qAdvice">‚Äî</div></div>
      </div>
    </div>
  </section>

  <!-- 3) HELP (minimal) -->
  <section id="help" class="card hidden">
    <h2>üìñ H∆∞·ªõng d·∫´n</h2>
    <p>
      Video: <a href="https://youtu.be/djg4uDW0q3g" target="_blank" style="color:#29d391">
      https://youtu.be/djg4uDW0q3g</a>
    </p>
  </section>
</div>
<footer>¬© 2025 NULY ‚Äì ·∫¢ R·∫¨P BU√îN V√ÄNG ‚Ä¢ Carl</footer>

<script>
// ===== Constants (sizing) =====
const LOT_STEP = 0.01;
const MIN_LOT = 0.01;

// ===== Helpers =====
const $ = id => document.getElementById(id);
const num = id => parseFloat($(id).value||"0");
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const fmt=(x,d=2)=> (isFinite(x)?x:0).toLocaleString(undefined,{minimumFractionDigits:d,maximumFractionDigits:d});
function showVal(id,v,d=2){ $(id).textContent = fmt(v,d); }

// Tabs
document.querySelectorAll('.tab-btn').forEach(b=>b.onclick=()=>{
  document.querySelectorAll('.tab-btn').forEach(x=>x.classList.remove('active')); b.classList.add('active');
  document.querySelectorAll('section.card').forEach(s=>s.classList.add('hidden'));
  $(b.dataset.tab).classList.remove('hidden');
});

// Mode toggle
function switchMode(){
  const mode = document.querySelector('input[name=mode]:checked').value;
  $('riskRow').classList.toggle('hidden', mode!=='risk');
  $('lotRow').classList.toggle('hidden', mode!=='lot');
  calc();
}
document.querySelectorAll('input[name=mode]').forEach(r=>r.onchange=switchMode);

// Quantize lot
function quantizeLot(lot){
  if (!isFinite(lot)) return 0;
  if (lot < MIN_LOT) return MIN_LOT;
  return Math.round(lot/LOT_STEP)*LOT_STEP;
}

// Sizing core
function fromRisk(eq,pct,rr,sl,per,fee,p){
  const R_target = eq*(pct/100);
  const lotIdeal = (sl*per)>0 ? R_target/(sl*per) : 0;
  const lot = quantizeLot(lotIdeal);
  const R_actual = lot*sl*per;
  const win = R_actual*rr - fee, loss = -R_actual - fee;
  const EV = p*win + (1-p)*loss;
  const bumped = lot > lotIdeal + 1e-9;
  return {R_target,R_actual,lot,win,loss,EV,pct,bumped};
}
function fromLot(eq,lotIn,rr,sl,per,fee,p){
  const lot = quantizeLot(lotIn);
  const R_actual = lot*sl*per;
  const pct = eq>0? (R_actual/eq*100):0;
  const win = R_actual*rr - fee, loss = -R_actual - fee;
  const EV = p*win + (1-p)*loss;
  return {R_target:R_actual, R_actual, lot, win, loss, EV, pct, bumped: lot !== lotIn};
}

let lastSizing = null;
function calc(){
  const eq=num('equity'), p=clamp(num('p'),0,1), rr=num('rr'), sl=num('sl'), per=num('per'), fee=num('fee'), tpd=num('tpd'), days=num('days');
  const mode=document.querySelector('input[name=mode]:checked').value;
  let out;
  if(mode==='risk'){ out=fromRisk(eq,num('riskPct'),rr,sl,per,fee,p); $('riskVal').textContent = out.pct.toFixed(2)+'%'; }
  else { out=fromLot(eq,num('lotIn'),rr,sl,per,fee,p); $('riskVal').textContent = out.pct.toFixed(2)+'%'; }
  lastSizing = out;
  $('lot-note').style.display = out.bumped ? 'inline-block' : 'none';

  showVal('riskUsdTarget', out.R_target);
  showVal('riskUsd', out.R_actual);
  showVal('lotOut', out.lot,2);
  showVal('win', out.win);
  showVal('loss', out.loss);
  const evPerTrade = out.EV;
  const evDay = evPerTrade * tpd;
  const evMonth = evDay * (days/12);
  showVal('ev', evPerTrade);
  showVal('evDay', evDay);
  showVal('evMonth', evMonth);

  // Sim
  const tb=$('sim').querySelector('tbody'); tb.innerHTML='';
  [0.25,0.5,0.75,1.0,1.5,2.0].forEach(rp=>{
    const s=fromRisk(eq,rp,rr,sl,per,fee,p);
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${rp.toFixed(2)}%</td><td>${fmt(s.R_target)}</td><td>${fmt(s.lot,2)}</td><td>${fmt(s.R_actual)}</td><td>${fmt(s.EV)}</td><td>${fmt(s.win)}</td><td>${fmt(s.loss)}</td>`;
    tb.appendChild(tr);
  });
}
calc();
['equity','p','rr','sl','per','fee','tpd','days','lotIn'].forEach(id=>{const el=$(id); if(!el) return; el.addEventListener('input', calc);});
$('riskPct').addEventListener('input', ()=>{ const v=parseFloat($('riskPct').value||'0'); $('riskVal').textContent=v.toFixed(2)+'%'; calc(); });

// ===== Prop / Daily Risk Control =====
function pullRFromSizing(){
  if(!lastSizing){ alert('H√£y t√≠nh ·ªü tab Kh·ªëi l∆∞·ª£ng tr∆∞·ªõc.'); return; }
  $('qR').value = lastSizing.R_actual.toFixed(2);
}
function calcProp(){
  const E0 = num('qE0');                 // start-of-day equity
  const dayPct = num('qDayPct')/100;     // daily limit %
  const PnL = num('qPLToday');           // realized + floating today
  const EqRef = num('qEq');              // overall reference equity
  const allPct = num('qAllPct')/100;     // overall limit %
  const cumLoss = Math.max(0, num('qCumLoss')); // cumulative loss before today
  const R = Math.max(0, num('qR'));      // risk per trade

  const dayCap = E0 * dayPct;
  const dayUsed = Math.max(0, -PnL);     // if PnL < 0, it's loss today
  const dayRemain = Math.max(0, dayCap - dayUsed);

  const allCap = EqRef * allPct;
  const allUsed = Math.max(0, cumLoss + Math.max(0, -PnL));
  const allRemain = Math.max(0, allCap - allUsed);

  const maxLoseDay = R>0 ? Math.floor(dayRemain / R) : 0;
  const maxLoseAll = R>0 ? Math.floor(allRemain / R) : 0;

  showVal('qDayCap', dayCap);
  showVal('qDayUsed', dayUsed);
  showVal('qDayRemain', dayRemain);

  showVal('qAllCap', allCap);
  showVal('qAllUsed', allUsed);
  showVal('qAllRemain', allRemain);

  $('qMaxLoseDay').textContent = maxLoseDay + ' l·ªánh';
  $('qMaxLoseAll').textContent = maxLoseAll + ' l·ªánh';

  let adv = '·ªîn ƒë·ªãnh';
  if (dayRemain <= R) adv = 'D·ª´ng: th√™m 1 l·ªánh thua l√† vi ph·∫°m DAILY';
  else if (allRemain <= R) adv = 'C·∫£nh b√°o: th√™m 1 l·ªánh thua l√† vi ph·∫°m OVERALL';
  else if (maxLoseDay <= 2) adv = 'Gi·∫£m R: ch·ªâ c√≤n ch·ªãu ƒë∆∞·ª£c ‚â§2 l·ªánh thua h√¥m nay';
  $('qAdvice').textContent = adv;
}
calcProp();
['qE0','qDayPct','qR','qPLToday','qEq','qAllPct','qCumLoss'].forEach(id=>{const el=$(id); if(!el) return; el.addEventListener('input', calcProp);});

// Toggle all notes
function toggleAllNotes(){
  const items = document.querySelectorAll('details.expl');
  const someClosed = Array.from(items).some(d=>!d.open);
  items.forEach(d=>{ d.open = someClosed; });
}

// Save/Load (basic for sizing)
function saveCfg(){ const o={mode:document.querySelector('input[name=mode]:checked').value,equity:num('equity'),p:num('p'),rr:num('rr'),riskPct:num('riskPct'),lotIn:num('lotIn'),sl:num('sl'),per:num('per'),fee:num('fee'),tpd:num('tpd'),days:num('days')}; localStorage.setItem('nuly_cfg_offline',JSON.stringify(o)); alert('ƒê√£ l∆∞u.'); }
function loadCfg(){ const raw=localStorage.getItem('nuly_cfg_offline'); if(!raw) return; const o=JSON.parse(raw); for(const k in o){ if($(k)) $(k).value=o[k]; } document.querySelector(`input[name=mode][value="${o.mode||'risk'}"]`).checked=true; switchMode(); calc(); }
switchMode();
</script>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('./service-worker.js').catch(function(err){
      console.log('SW reg failed', err);
    });
  });
}
</script>

</body>
</html>
